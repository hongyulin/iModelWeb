!function(e,r){"object"===typeof exports&&"object"===typeof module?module.exports=r(require("bentleyjs_core"),require("imodeljs_common"),require("imodeljs_frontend")):"function"===typeof define&&define.amd?define("wmsPlugin",["bentleyjs_core","imodeljs_common","imodeljs_frontend"],r):"object"===typeof exports?exports.wmsPlugin=r(require("bentleyjs_core"),require("imodeljs_common"),require("imodeljs_frontend")):e.wmsPlugin=r(e.bentleyjs_core,e.imodeljs_common,e.imodeljs_frontend)}(this,function(e,r,t){return(this.webpackJsonp=this.webpackJsonp||[]).push([[1],{"./lib/wmsPlugin.js":function(e,r,t){"use strict";Object.defineProperty(r,"__esModule",{value:!0});const i=t("@bentley/bentleyjs-core"),s=t("@bentley/imodeljs-common"),n=t("@bentley/imodeljs-frontend");class WMSImageryProvider extends n.ImageryProviderEPSG3857{constructor(e,r,t,i){super(),this._i18n=r,this._i18NNamespace=t,this._logoImage=i;const s=new Date;s.setDate(s.getDate()-1);const n=s.toISOString();this._baseUrl="",this._baseUrl=0===e?"http://wms.actionmodulers.com/wms/wms?SERVICE=WMS&VERSION=1.3.0&REQUEST=GetMap&FORMAT=image%2Fpng&"+`TRANSPARENT=true&LAYERS=TM_WORLD_BORDERS-0.3%2CHRRR_USA_0.03_SubHourly%20%5Bair%20temperature%5D&TILED=true&MAP_TYPE=DEF&TIME=${n}`+"&WIDTH=256&HEIGHT=256&CRS=EPSG%3A3857&STYLES=&BBOX={BoundingBox}":"http://wms.actionmodulers.com/wms/wms?SERVICE=WMS&VERSION=1.3.0&REQUEST=GetMap&FORMAT=image%2Fpng&"+`TRANSPARENT=true&LAYERS=TM_WORLD_BORDERS-0.3%2CHRRR_USA_0.03_SubHourly%20%5Bprecipitation%5D&TILED=true&MAP_TYPE=DEF&TIME=${n}`+"&WIDTH=256&HEIGHT=256&CRS=EPSG%3A3857&STYLES=&BBOX={BoundingBox}"}get tileWidth(){return 256}get tileHeight(){return 256}get minimumZoomLevel(){return 4}get maximumZoomLevel(){return 20}constructUrl(e,r,t){const i=this.getEPSG3857Extent(e,r,t),s=`${i.left},${i.bottom},${i.right},${i.top}`;return this._baseUrl.replace("{BoundingBox}",s)}getImageryLogo(e){return n.IModelApp.makeLogoCard({iconSrc:this._logoImage,heading:"WMS",notice:this._i18n.translate("WmsPlugin:Messages.Copyright")})}async initialize(){return this._i18NNamespace.readFinished}}class WMSTreeSupplier{constructor(e){this._plugin=e}compareTileTreeIds(e,r){return i.compareNumbers(e,r)}async createTileTree(e,r){return n.createTileTreeFromImageryProvider(this._plugin.imageryProviders[e],0,!1,s.GlobeMode.Columbus,r)}}class WMSTreeRef extends n.MapTileTreeReference{constructor(e,r){super(),this._plugin=e,this.iModel=r}get _graphicType(){return n.TileTree.GraphicType.Overlay}get _groundBias(){return 0}get _imageryProvider(){return this._plugin.currentImageryProvider}get _transparency(){return.7}get treeOwner(){return this.iModel.tiles.getTileTreeOwner(this._plugin.currentImageryType,this._plugin.treeSupplier)}}class WMSGraphicsProvider{constructor(e,r){this._tree=new WMSTreeRef(r,e)}forEachTileTreeRef(e,r){this._tree.iModel=e.iModel,r(this._tree)}}n.IModelApp.pluginAdmin.register(new class WMSPlugin extends n.Plugin{constructor(e){super(e),this.imageryProviders=[],this._currentImageryType=1,this.treeSupplier=new WMSTreeSupplier(this)}get currentImageryType(){return this._currentImageryType}get currentImageryProvider(){return this.imageryProviders[this.currentImageryType]}onLoad(e){this._i18NNamespace=this.i18n.registerNamespace("WmsPlugin");const r=this.resolveResourceUrl("wmsPlugin.svg");this.imageryProviders.push(new WMSImageryProvider(0,this.i18n,this._i18NNamespace,r)),this.imageryProviders.push(new WMSImageryProvider(1,this.i18n,this._i18NNamespace,r))}onExecute(e){const r=n.IModelApp.viewManager.selectedView;if(void 0===r)return;void 0===this._graphicsProvider&&(this._graphicsProvider=new WMSGraphicsProvider(r.iModel,this)),r.addTiledGraphicsProvider(this._graphicsProvider),this._currentImageryType=0===this._currentImageryType?1:0;const t=0===this._currentImageryType?"temperature":"precipitation";this._i18NNamespace.readFinished.then(()=>{const e=this.i18n.translate("WmsPlugin:Messages.DisplayType",{weatherType:t}),r=new n.NotifyMessageDetails(n.OutputMessagePriority.Info,e);n.IModelApp.notifications.outputMessage(r)}).catch(()=>{})}}("wmsPlugin"))},"@bentley/bentleyjs-core":function(r,t){r.exports=e},"@bentley/imodeljs-common":function(e,t){e.exports=r},"@bentley/imodeljs-frontend":function(e,r){e.exports=t}},[["./lib/wmsPlugin.js",0]]])});
//# sourceMappingURL=wmsPlugin.js.map